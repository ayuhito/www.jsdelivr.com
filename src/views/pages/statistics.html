<link rel="ractive" href="../r-page.html" />
<link rel="ractive" href="../components/coming-soon.html" name="c-coming-soon"/>
<link rel="ractive" href="../components/header.html" name="c-header" />
<link rel="ractive" href="../components/footer.html" name="c-footer" />
<link rel="ractive" href="../components/notification.html" name="c-notification"/>
<link rel="ractive" href="../components/stats-table.html" name="c-stats-table"/>

<link rel="ractive" href="../components/network-provider-stats.html" name="c-network-provider-stats" />
<link rel="ractive" href="../components/network-request-chart.html" name="c-network-request-chart" />
<link rel="ractive" href="../components/top-platform-browser.html" name="c-top-platform-browser" />

<r-page noYield="{{noYield}}" title="{{title}}" description="{{description}}">
	<c-notification></c-notification>
	<c-header></c-header>
	<div class="p-statistics">
		<div class="container">
			<div class="head-wrapper">
				<img
					class="head-map-bg"
					width="800"
					height="428"
					src="{{@shared.assetsHost}}/img/sponsors/map.svg"
				/>
				<h2 class="head-title">Statistics</h2>
				<p class="head-text">
					Global internet insights from jsDelivr based on anonymous
					aggregated data
				</p>
				<div class="global_data">
					<div class="global_data_info">
						<img
							width="44"
							height="48"
							src="{{@shared.assetsHost}}/img/statistics/globalData.svg"
							loading="lazy"
						/>
						<h2 class="title">Global data</h2>
					</div>
					<div class="header-ctrls">
						<div class="data-range-ctrl">
							<div class="btn-group">
								<span class="label-for-pinned">Data range</span>
								<button
									type="button"
									class="btn dropdown-toggle"
									data-toggle="dropdown"
									aria-haspopup="true"
									aria-expanded="false"
								>
									<span>{{ globalStatsPeriod }}</span>
									<i
										class="fa fa-angle-down"
										aria-hidden="true"
									></i>
								</button>

								<ul class="dropdown-menu">
									{{#each statsPeriods}}
									<li>
										<a
											on-click="@this.set('globalStatsPeriod', @key)"
											>{{@key}}</a
										>
									</li>
									{{/each}}
								</ul>
							</div>
						</div>
					</div>
				</div>
				<div class="verticalLine" />
				<c-network-provider-stats period="{{ globalStatsPeriod }}"></c-network-provider-stats>
				<div class="hit-rate">
					<h3>Cache hit rate</h3>
					<div class="rate-row">
						{{#each rateList}}
						<div class="row-item">
							<div>
								<img
									class="icon"
									width="24"
									height="24"
									src='{{@shared.assetsHost}}{{svg}}'
								/>
								<span>{{name}}</span>
							</div>
							<p>{{interest}}</p>
						</div>
					  {{/each}}
					</div>
				</div>
			</div>
		</div>
		<div class="grey">
			<div class="container">
				<div class="network-data">
					<div class="network-data-info">
						<img
							width="44"
							height="48"
							src="{{@shared.assetsHost}}/img/statistics/network.svg"
							loading="lazy"
						/>
						<h2 class="title">Network data</h2>
					</div>
					<div class="network-data-action">
						<input class="search" placeholder="Filter for a specific country or a continent..."/>
						<div class="data-range-ctrl">
							<div class="btn-group">
								<div class="eac-item WW" on-click="@this.setCountryAsGlobal()"><img src="/img/statistics/flags/WW.svg"/>Global</div>
								<span class="label-for-pinned">Data range</span>
								<button
									type="button"
									class="btn dropdown-toggle"
									data-toggle="dropdown"
									aria-haspopup="true"
									aria-expanded="false"
								>
									<span>{{ networkStatsPeriod }}</span>
									<i
										class="fa fa-angle-down"
										aria-hidden="true"
									></i>
								</button>

								<ul class="dropdown-menu">
									{{#each statsPeriods}}
									<li>
										<a
											on-click="@this.set('networkStatsPeriod', @key)"
											>{{@key}}</a
										>
									</li>
									{{/each}}
								</ul>
							</div>
						</div>
					</div>
				</div>
				<div class="verticalLine" />
				<c-network-request-chart __ready="{{ __ready }}" period="{{ networkStatsPeriod }}" country="{{ country }}"></c-network-request-chart>
				<div class="map"></div>
				<div class="tops">
					<c-top-platform-browser __ready="{{ __ready }}" type="platform"></c-top-platform-browser>
					<c-top-platform-browser __ready="{{ __ready }}" type="browser"></c-top-platform-browser>
				</div>
			</div>
		</div>
		<div class="container">
			<div class="projects-data">
				<div class="projects_data_info">
					<img
						width="44"
						height="48"
						src="{{@shared.assetsHost}}/img/statistics/projects.svg"
						loading="lazy"
					/>
					<h2 class="title">Projects statistics</h2>
				</div>
				<div class="data-range-ctrl">
					<div class="btn-group">
						<button
							type="button"
							class="btn dropdown-toggle"
							data-toggle="dropdown"
							aria-haspopup="true"
							aria-expanded="false"
						>
							<span>{{ projectStatsPeriod }}</span>
							<i
								class="fa fa-angle-down"
								aria-hidden="true"
							></i>
						</button>

						<ul class="dropdown-menu">
							{{#each statsPeriods}}
							<li>
								<a
									on-click="@this.set('projectStatsPeriod', @key)"
									>{{@key}}</a
								>
							</li>
							{{/each}}
						</ul>
					</div>
				</div>
			</div>
			<div class="verticalLine" />
			<div class="projects-popular-info">
				<h3>Most popular projects</h3>
				<div class="btn-group">
					<span>Type:</span>
					<button
						type="button"
						class="btn dropdown-toggle"
						data-toggle="dropdown"
						aria-haspopup="true"
						aria-expanded="false"
					>
						<span>{{statsPopular}}</span>
						<i
							class="fa fa-angle-down"
							aria-hidden="true"
						></i>
					</button>

					<ul class="dropdown-menu">
						{{#each statsPopulars}}
						<li>
							<a
								on-click="@this.set('statsPopular', @key)"
								>{{this}}</a
							>
						</li>
						{{/each}}
					</ul>
				</div>
			</div>
			<div class="projects-data-table">
				<table>
					<tr>
						<th>Name</th>
						<th>Requests</th>
						<th>Bandwidth</th>
						<th></th>
					</tr>
					{{#each popularProjects}}
						<tr>
							<td>
								<span class="id">{{id}}</span>
								<div><span>{{package}}<span>/<p>{{name}}</p></div>
							</td>
							<td>
								{{request}}
								<div class="percentage-bar">
									<div class="barWidth">

									</div>
								</div>
							</td>
							<td>
								{{bandwidth}}
								<div class="percentage-bar">
									<div class="barWidth">

									</div>
								</div>
							</td>
							<td></td>
						</tr>
					{{/each}}
				</table>
				<div class="pagination">
					<p>Records 1 - 10 of 43</p>
					<div class="pagination-change-page">
						<button>
							<img
								width="20"
								height="24"
								src="{{@shared.assetsHost}}/img/statistics/left.svg"
								loading="lazy"
							/>
						</button>
						<button>
							1
						</button>
						<button class="selected">
							2
						</button>
						<button>
							3
						</button>
						<button>
							4
						</button>
						<button>
							5
						</button>
						<button>
							<img
								width="24"
								height="24"
								src="{{@shared.assetsHost}}/img/statistics/right.svg"
								loading="lazy"
							/>
						</button>
					</div>
					<div class="btn-group">
						<span>Show:</span>
						<button
							type="button"
							class="btn dropdown-toggle"
							data-toggle="dropdown"
							aria-haspopup="true"
							aria-expanded="false"
						>
							<span>{{statsPagination}}</span>
							<i
								class="fa fa-angle-down"
								aria-hidden="true"
							></i>
						</button>
						<ul class="dropdown-menu">
							{{#each statsPaginations}}
							<li>
								<a
									on-click="@this.set('statsPagination', @key)"
									>{{this}}</a
								>
							</li>
							{{/each}}
						</ul>
						<span>per page</span>
					</div>
				</div>
			</div>
			<div class="projects-data-table-mobile">
				<div class="table">
					{{#each popularProjects}}
						<div class="table-item">
							<div class="name">
								<span class="id">{{id}}</span>
								<span class="prefix">{{package}}/</span>
								<p>{{name}}</p>
							</div>
							<h5 class="item-name">Requests</h5>
							<div class="requests">
								{{request}}
								<div class="percentage-bar">
									<div class="barWidth">

									</div>
								</div>
							</div>
							<h5 class="item-name">Bandwidth</h5>
							<div class="requests">
								{{bandwidth}}
								<div class="percentage-bar">
									<div class="barWidth">
									</div>
								</div>
							</div>
						</div>
					{{/each}}
					<div class="pagination">
						<p>1-10 of 43</p>
						<div class="action">
							<button class="prew">
								<img
									width="20"
									height="24"
									src="{{@shared.assetsHost}}/img/statistics/left.svg"
									loading="lazy"
								/>
							</button>
							<div class="btn-group">
								<button
									type="button"
									class="btn dropdown-toggle"
									data-toggle="dropdown"
									aria-haspopup="true"
									aria-expanded="false"
								>
									<span>Page:</span>
									<span>{{statsPagination}}</span>
									<i
										class="fa fa-angle-down"
										aria-hidden="true"
									></i>
								</button>
								<ul class="dropdown-menu">
									{{#each statsPaginations}}
									<li>
										<a
											on-click="@this.set('statsPagination', @key)"
											>{{this}}</a
										>
									</li>
									{{/each}}
								</ul>
							</div>
							<button class="next">
								<img
									width="24"
									height="24"
									src="{{@shared.assetsHost}}/img/statistics/right.svg"
									loading="lazy"
								/>
							</button>
						</div>
					</div>
				</div>
			</div>
			<div class="projects-popular-info">
				<h3>Most popular projects</h3>
				<div class="btn-group mobile">
					<span>Type:</span>
					<button
						type="button"
						class="btn dropdown-toggle"
						data-toggle="dropdown"
						aria-haspopup="true"
						aria-expanded="false"
					>
						<span>{{statsPopular}}</span>
						<i
							class="fa fa-angle-down"
							aria-hidden="true"
						></i>
					</button>

					<ul class="dropdown-menu">
						{{#each statsPopulars}}
						<li>
							<a
								on-click="@this.set('statsPopular', @key)"
								>{{this}}</a
							>
						</li>
						{{/each}}
					</ul>
				</div>
			</div>
			<div class="projects-data-table trending">
				<table>
					<tr>
						<th>Name</th>
						<th>Requests</th>
						<th>Bandwidth</th>
						<th>Increased</th>
					</tr>
					{{#each popularProjects}}
						<tr>
							<td>
								<span class="id">{{id}}</span>
								<div><span>{{package}}<span>/<p>{{name}}</p></div>
							</td>
							<td>
								{{request}}
								<div class="percentage-bar">
									<div class="barWidth">

									</div>
								</div>
							</td>
							<td>
								{{bandwidth}}
								<div class="percentage-bar">
									<div class="barWidth">

									</div>
								</div>
							</td>
							<td class="green">{{increased}}</td>
						</tr>
					{{/each}}
				</table>
				<div class="pagination">
					<p>Records 1 - 10 of 43</p>
					<div class="pagination-change-page">
						<button>
							<img
								width="20"
								height="24"
								src="{{@shared.assetsHost}}/img/statistics/left.svg"
								loading="lazy"
							/>
						</button>
						<button>
							1
						</button>
						<button class="selected">
							2
						</button>
						<button>
							3
						</button>
						<button>
							4
						</button>
						<button>
							5
						</button>
						<button>
							<img
								width="24"
								height="24"
								src="{{@shared.assetsHost}}/img/statistics/right.svg"
								loading="lazy"
							/>
						</button>
					</div>
					<div class="btn-group">
						<span>Show:</span>
						<button
							type="button"
							class="btn dropdown-toggle"
							data-toggle="dropdown"
							aria-haspopup="true"
							aria-expanded="false"
						>
							<span>{{statsPagination}}</span>
							<i
								class="fa fa-angle-down"
								aria-hidden="true"
							></i>
						</button>
						<ul class="dropdown-menu">
							{{#each statsPaginations}}
							<li>
								<a
									on-click="@this.set('statsPagination', @key)"
									>{{this}}</a
								>
							</li>
							{{/each}}
						</ul>
						<span>per page</span>
					</div>
				</div>
			</div>
			<div class="projects-data-table-mobile">
				<div class="table">
					{{#each popularProjects}}
						<div class="table-item">
							<div class="name">
								<span class="id">{{id}}</span>
								<span class="prefix">{{package}}/</span>
								<p>{{name}}</p>
								<span class="green">{{increased}}</span>
							</div>
							<h5 class="item-name">Requests</h5>
							<div class="requests">
								{{request}}
								<div class="percentage-bar">
									<div class="barWidth">

									</div>
								</div>
							</div>
							<h5 class="item-name">Bandwidth</h5>
							<div class="requests">
								{{bandwidth}}
								<div class="percentage-bar">
									<div class="barWidth">
									</div>
								</div>
							</div>
						</div>
					{{/each}}
					<div class="pagination">
						<p>1-10 of 43</p>
						<div class="action">
							<button class="prew">
								<img
									width="20"
									height="24"
									src="{{@shared.assetsHost}}/img/statistics/left.svg"
									loading="lazy"
								/>
							</button>
							<div class="btn-group">
								<button
									type="button"
									class="btn dropdown-toggle"
									data-toggle="dropdown"
									aria-haspopup="true"
									aria-expanded="false"
								>
									<span>Page:</span>
									<span>{{statsPagination}}</span>
									<i
										class="fa fa-angle-down"
										aria-hidden="true"
									></i>
								</button>
								<ul class="dropdown-menu">
									{{#each statsPaginations}}
									<li>
										<a
											on-click="@this.set('statsPagination', @key)"
											>{{this}}</a
										>
									</li>
									{{/each}}
								</ul>
							</div>
							<button class="next">
								<img
									width="24"
									height="24"
									src="{{@shared.assetsHost}}/img/statistics/right.svg"
									loading="lazy"
								/>
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<c-footer></c-footer>
</r-page>

<script>
	const _ = require('../../public/js/_');
	const tooltip = require('../../public/js/decorators/tooltip');
	const countries = require('../../public/json/countries.json');

	component.exports = {
		data () {
			return {
				_,
				desc: true,
				title: 'Usage statistics - jsDelivr',
				name: 'd3',
				description: 'Load modern JavaScript packages built for you on-demand. Works in modern web browsers, node.js, and deno.',
				statsPeriods: {
					day: 1,
					week: 7,
					month: 30,
					year: 365,
				},
				globalStatsPeriod: "month",
				rateList: [
					{ 
						svg: '/img/statistics/cloudflare.svg',
						name: 'Cloudflare', 
						interest: '99.99%' 
					}, 
					{ 
						svg: '/img/statistics/fastly.svg', 
						name: 'Fastly', 
						interest: '99.98%' 
					},
					{ 
						svg: '/img/statistics/g-core.svg', 
						name: 'G-Core', 
						interest: '99.81%' 
					}
				],
				country: "",
				networkStatsPeriod: "month",
				statsPagination: '10',
				statsPaginations: [ '20', '30', '40' ],
				projectStatsPeriod: "month",
				statsPopular: 'All types',
				statsPopulars: [ 'All types', 'All types', 'All types' ],
				popularProjects: [{ id: '1', package: 'gh', name: 'prebid-universal-creative', request: '185 849 174', bandwidth: '183 849 GB', increased: '+24.45%' }, { id: '1', package: 'gh', name: 'prebid-universal-creative', request: '185 849 174', bandwidth: '183 849 GB', increased: '+24.45%' }, { id: '1', package: 'gh', name: 'prebid-universal-creative', request: '185 849 174', bandwidth: '183 849 GB', increased: '+24.45%' }, { id: '1', package: 'gh', name: 'prebid-universal-creative', request: '185 849 174', bandwidth: '183 849 GB', increased: '+24.45%' }, { id: '1', package: 'gh', name: 'prebid-universal-creative', request: '185 849 174', bandwidth: '183 849 GB', increased: '+24.45%' }, { id: '1', package: 'gh', name: 'prebid-universal-creative', request: '185 849 174', bandwidth: '183 849 GB', increased: '+24.45%' }, { id: '1', package: 'gh', name: 'prebid-universal-creative', request: '185 849 174', bandwidth: '183 849 GB', increased: '+24.45%' }, { id: '1', package: 'gh', name: 'prebid-universal-creative', request: '185 849 174', bandwidth: '183 849 GB', increased: '+24.45%' }, { id: '1', package: 'gh', name: 'prebid-universal-creative', request: '185 849 174', bandwidth: '183 849 GB', increased: '+24.45%' }, { id: '1', package: 'gh', name: 'prebid-universal-creative', request: '185 849 174', bandwidth: '183 849 GB', increased: '+24.45%' }],
			};
		},
		// decorators: {
		// 	tooltip,
		// },
		onrender () {
			let $this = this;
			let flagIconPath = "/img/statistics/flags";
			let options = {
				data: countries,
				getValue: "name",
				list: {
					match: {
						enabled: true
					},
					maxNumberOfElements: 15,
					onClickEvent: function() {
						let code = $(".search").getSelectedItemData().code;
						
						$this.set("country", code);
					},
					onShowListEvent: function() {
						$(".search").removeAttr('style');

						$(".eac-item.WW").show();
					},
					onHideListEvent: function() {
						let selectedCode = $this.get("country");
						if(selectedCode) {
							$(".search").css({
								"background-image": `url('${flagIconPath}/${selectedCode}.svg')`,
								"background-size": "17px"
							})
						}

						$(".eac-item.WW").hide();
					},
					onMouseOutEvent: function() {
						$(".easy-autocomplete-container li.selected").removeClass("selected");
					}
				},
				template: {
					type: "custom",
					method: function(value, item) {
						return `<img src="${flagIconPath}/${item.code}.svg"/>` + value;
					}
				},
				theme: "round"
			};

			$(".search").easyAutocomplete(options);

			// move rendered Global autocomplete item into autocomplete container after building autocomplete...
			$(".eac-item.WW").detach().prependTo(".easy-autocomplete-container");
		},
		oncomplete() {
			let el = this.find(".global_data");
			this.stickyObserve(el);
			el = this.find(".network-data");
			this.stickyObserve(el);
		},
		stickyObserve(el) {
			let observer = new IntersectionObserver( ([e]) => e.target.classList.toggle("is-pinned", e.intersectionRatio < 1),
  				{ threshold: [1] }
			);
			observer.observe(el);
		},
		setCountryAsGlobal() {				// set country as <Global>
			$('.search').val('Global');
			this.set('country', 'WW');
		}
	};
</script>
